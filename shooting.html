<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>미니 1대1 FPS (2D)</title>
<style>
  body {
    margin: 0; padding: 0; background: #222; color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
  }
  #gameCanvas {
    background: #333;
    display: block;
    margin: 0 auto;
    border: 3px solid #555;
  }
  #ui {
    text-align: center;
    margin: 10px 0;
  }
  button {
    background: #ff6f91;
    border: none;
    padding: 8px 16px;
    color: white;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
  }
  #instructionsModal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    color: #fff;
  }
  #instructionsContent {
    background: #444;
    padding: 20px 30px;
    border-radius: 10px;
    max-width: 400px;
    text-align: left;
  }
  #closeInstructions {
    background: #ff4757;
    margin-top: 15px;
  }
</style>
</head>
<body>

<div id="ui">
  <button id="showInstructions">조작법 보기</button>
</div>

<canvas id="gameCanvas" width="800" height="500"></canvas>

<div id="instructionsModal">
  <div id="instructionsContent">
    <h2>조작법</h2>
    <ul>
      <li><b>플레이어 1 (파란색):</b> W/A/S/D - 이동, 스페이스바 - 총알 발사</li>
      <li><b>플레이어 2 (빨간색):</b> 방향키 ←↑→↓ - 이동, 엔터키 - 총알 발사</li>
      <li>총알에 맞으면 상대방 점수 획득</li>
      <li>점수는 좌측 상단에 표시</li>
    </ul>
    <button id="closeInstructions">닫기</button>
  </div>
</div>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const width = canvas.width;
  const height = canvas.height;

  // 플레이어 설정
  class Player {
    constructor(x, y, color, controls) {
      this.x = x;
      this.y = y;
      this.color = color;
      this.size = 30;
      this.speed = 4;
      this.score = 0;
      this.controls = controls;
      this.bullets = [];
      this.cooldown = 0; // 발사 딜레이
    }
    move(keys) {
      if (keys[this.controls.up] && this.y - this.speed > 0) this.y -= this.speed;
      if (keys[this.controls.down] && this.y + this.speed + this.size < height) this.y += this.speed;
      if (keys[this.controls.left] && this.x - this.speed > 0) this.x -= this.speed;
      if (keys[this.controls.right] && this.x + this.speed + this.size < width) this.x += this.speed;
    }
    shoot() {
      if(this.cooldown === 0) {
        // 총알은 앞으로(오른쪽 플레이어는 오른쪽, 왼쪽 플레이어는 왼쪽으로 발사)
        let dir = this.color === 'blue' ? 1 : -1;
        let bulletX = this.color === 'blue' ? this.x + this.size : this.x;
        let bulletY = this.y + this.size/2;
        this.bullets.push(new Bullet(bulletX, bulletY, dir));
        this.cooldown = 15; // 쿨타임 15 프레임
      }
    }
    updateBullets(opponent) {
      this.bullets.forEach((b, i) => {
        b.move();
        if(b.x < 0 || b.x > width) this.bullets.splice(i, 1);
        else if(b.collidesWith(opponent)) {
          this.score++;
          this.bullets.splice(i, 1);
          resetPositions();
        }
      });
      if(this.cooldown > 0) this.cooldown--;
    }
    draw() {
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x, this.y, this.size, this.size);
      // 총알 그리기
      this.bullets.forEach(b => b.draw());
    }
  }

  class Bullet {
    constructor(x, y, dir) {
      this.x = x;
      this.y = y;
      this.radius = 6;
      this.speed = 8 * dir;
    }
    move() {
      this.x += this.speed;
    }
    collidesWith(player) {
      return (this.x > player.x && this.x < player.x + player.size) &&
             (this.y > player.y && this.y < player.y + player.size);
    }
    draw() {
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
      ctx.fill();
    }
  }

  const keys = {};
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    // 특수키는 key 대신 code로 처리할 수도 있음
    // 스페이스바, 엔터 등
    if(e.code === 'Space') keys['space'] = true;
    if(e.code === 'Enter') keys['enter'] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
    if(e.code === 'Space') keys['space'] = false;
    if(e.code === 'Enter') keys['enter'] = false;
  });

  const player1 = new Player(50, height/2 - 15, 'blue', {
    up: 'w', down: 's', left: 'a', right: 'd', shoot: 'space'
  });
  const player2 = new Player(width - 80, height/2 - 15, 'red', {
    up: 'arrowup', down: 'arrowdown', left: 'arrowleft', right: 'arrowright', shoot: 'enter'
  });

  function resetPositions() {
    player1.x = 50;
    player1.y = height/2 - player1.size/2;
    player2.x = width - 80;
    player2.y = height/2 - player2.size/2;
    player1.bullets = [];
    player2.bullets = [];
  }

  function drawScores() {
    ctx.font = '20px Arial';
    ctx.fillStyle = 'blue';
    ctx.fillText(`Player 1 (파란색): ${player1.score}`, 20, 30);
    ctx.fillStyle = 'red';
    ctx.fillText(`Player 2 (빨간색): ${player2.score}`, width - 220, 30);
  }

  function gameLoop() {
    ctx.clearRect(0, 0, width, height);

    player1.move(keys);
    player2.move(keys);

    if(keys['space']) player1.shoot();
    if(keys['enter']) player2.shoot();

    player1.updateBullets(player2);
    player2.updateBullets(player1);

    player1.draw();
    player2.draw();

    drawScores();

    requestAnimationFrame(gameLoop);
  }

  resetPositions();
  gameLoop();

  // 조작법 모달
  const modal = document.getElementById('instructionsModal');
  const btnShow = document.getElementById('showInstructions');
  const btnClose = document.getElementById('closeInstructions');

  btnShow.addEventListener('click', () => {
    modal.style.display = 'flex';
  });
  btnClose.addEventListener('click', () => {
    modal.style.display = 'none';
  });
</script>

</body>
</html>
